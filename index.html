<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurum Real Estate | Premium Property Solutions</title>
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Chart.js & Datepicker -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    <style>
        /* ===== ROOT VARIABLES ===== */
        :root {
            --primary-gold: #D4AF37;
            --secondary-gold: #F5D76E;
            --dark-gold: #B8860B;
            --light-gold: #FFF9E6;
            --dark-bg: #121212;
            --light-bg: #FFFFFF;
            --text-dark: #333333;
            --text-light: #F0F0F0;
            --gray-bg: #F4F6F8;
            --border-color: #E0E0E0;
            --card-bg: #FFFFFF;
            --sidebar-width: 280px;
            --shadow: 0 10px 30px rgba(0,0,0,0.08);
            --shadow-lg: 0 20px 50px rgba(0,0,0,0.15);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        /* ===== DARK MODE ===== */
        [data-theme="dark"] {
            --primary-gold: #D4AF37;
            --secondary-gold: #B8860B;
            --light-gold: #2C2C2C;
            --dark-bg: #050505;
            --light-bg: #121212;
            --text-dark: #E0E0E0;
            --text-light: #F0F0F0;
            --gray-bg: #1E1E1E;
            --border-color: #333333;
            --card-bg: #1E1E1E;
            --shadow: 0 10px 30px rgba(0,0,0,0.5);
            --shadow-lg: 0 20px 50px rgba(0,0,0,0.7);
        }

        /* ===== RESET & BASE ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text-dark);
            background: var(--light-bg);
            line-height: 1.6;
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
        }

        /* ===== TYPOGRAPHY ===== */
        h1, h2, h3, h4, h5 { font-family: 'Playfair Display', serif; font-weight: 600; }
        .section-title {
            text-align: center; font-size: 2.5rem; margin-bottom: 3rem; position: relative;
        }
        .section-title:after {
            content: ''; position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
            width: 80px; height: 3px; background: var(--primary-gold);
        }

        /* ===== ANIMATIONS ===== */
        .animate-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; }
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }
        .fade-in { animation: fadeIn 0.3s ease forwards; }
        
        @keyframes slideUp { 
            from { transform: translateY(30px); opacity: 0; } 
            to { transform: translateY(0); opacity: 1; } 
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed; top: 90px; right: 20px; padding: 1rem 1.5rem;
            border-radius: 8px; z-index: 9999; display: flex; align-items: center; gap: 10px;
            box-shadow: var(--shadow-lg); max-width: 400px; transform: translateX(150%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .notification.show { transform: translateX(0); }
        .notification.success { background: #4CAF50; color: white; border-left: 4px solid #2E7D32; }
        .notification.error { background: #f44336; color: white; border-left: 4px solid #c62828; }
        .notification.info { background: #2196F3; color: white; border-left: 4px solid #0d47a1; }
        .notification.warning { background: #ff9800; color: white; border-left: 4px solid #ef6c00; }

        /* ===== LOADING SKELETONS ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-bg) 25%, var(--border-color) 50%, var(--gray-bg) 75%);
            background-size: 200% 100%; animation: loading 1.5s infinite;
        }
        @keyframes loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        /* ===== BREADCRUMBS ===== */
        .breadcrumb {
            padding: 1rem 2rem; background: var(--gray-bg); border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        .breadcrumb a { color: var(--primary-gold); text-decoration: none; }
        .breadcrumb span { color: #777; }

        /* ===== BUTTONS & INPUTS ===== */
        .btn-primary {
            background: var(--primary-gold); color: #000; border: none; padding: 0.8rem 2rem;
            border-radius: 6px; font-weight: 600; cursor: pointer; transition: var(--transition);
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.3); }
        
        .btn-outline {
            background: transparent; border: 1px solid var(--primary-gold); color: var(--primary-gold);
            padding: 0.8rem 2rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: var(--transition);
        }
        .btn-outline:hover { background: var(--primary-gold); color: #000; }

        .btn-sm { padding: 0.5rem 1rem; font-size: 0.9rem; }

        input, select, textarea {
            padding: 0.8rem 1rem; border: 1px solid var(--border-color); border-radius: 6px;
            background: var(--card-bg); color: var(--text-dark); width: 100%; font-family: 'Inter', sans-serif;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-gold); box-shadow: 0 0 0 2px rgba(212, 175, 55, 0.1); }

        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--text-dark); }

        /* ===== NAVIGATION ===== */
        .navbar {
            background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(10px);
            position: fixed; top: 0; width: 100%; z-index: 1000; padding: 1rem 0;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }
        .nav-container {
            max-width: 1400px; margin: 0 auto; padding: 0 2rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo {
            display: flex; align-items: center; gap: 12px; color: var(--primary-gold);
            font-size: 1.5rem; font-weight: 700; text-decoration: none; letter-spacing: 1px; cursor: pointer;
        }
        .nav-menu { display: flex; gap: 2rem; align-items: center; }
        .nav-menu a {
            color: #FFF; text-decoration: none; font-weight: 500; font-size: 0.95rem;
            transition: color 0.3s; text-transform: uppercase; letter-spacing: 0.5px;
            position: relative;
        }
        .nav-menu a:after {
            content: ''; position: absolute; bottom: -5px; left: 0; width: 0; height: 2px;
            background: var(--primary-gold); transition: width 0.3s;
        }
        .nav-menu a:hover:after, .nav-menu a.active:after { width: 100%; }
        .nav-menu a:hover, .nav-menu a.active { color: var(--primary-gold); }

        .theme-btn {
            background: transparent; border: 1px solid var(--primary-gold); color: var(--primary-gold);
            width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: var(--transition);
        }
        .theme-btn:hover { background: var(--primary-gold); color: #000; }

        .mobile-menu-btn { display: none; font-size: 1.5rem; color: white; cursor: pointer; }

        /* ===== HERO ===== */
        .hero {
            height: 90vh; position: relative; display: flex; align-items: center; justify-content: center;
            overflow: hidden; margin-top: -80px;
        }
        .hero video {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: -1;
        }
        .hero-overlay {
            background: linear-gradient(to bottom, rgba(0,0,0,0.3), rgba(0,0,0,0.8));
            width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 2rem; text-align: center; z-index: 1;
        }
        .hero h1 {
            font-size: 4rem; color: #FFF; margin-bottom: 1rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.6);
            animation: fadeIn 1s ease;
        }

        /* ===== SEARCH BAR ===== */
        .search-bar {
            background: var(--card-bg); padding: 2rem; border-radius: 12px; box-shadow: var(--shadow-lg);
            margin-top: -50px; position: relative; z-index: 100; max-width: 1200px; margin-left: auto; margin-right: auto;
        }
        .search-form {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr auto; gap: 1rem; align-items: end;
        }
        .search-form input, .search-form select { margin-bottom: 0; }
        .search-suggestions {
            position: absolute; background: var(--card-bg); border-radius: 8px; box-shadow: var(--shadow);
            width: 100%; top: 100%; left: 0; z-index: 1000; max-height: 300px; overflow-y: auto;
            display: none; border: 1px solid var(--border-color);
        }
        .search-suggestions.show { display: block; }
        .suggestion-item { padding: 0.8rem 1rem; cursor: pointer; transition: 0.2s; }
        .suggestion-item:hover { background: var(--gray-bg); }

        /* ===== PROPERTY GRID & CARDS ===== */
        .container { max-width: 1400px; margin: 0 auto; padding: 4rem 2rem; }
        .property-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 2rem;
        }
        .property-card {
            background: var(--card-bg); border-radius: 12px; overflow: hidden;
            box-shadow: var(--shadow); transition: var(--transition); cursor: pointer;
            border: 1px solid var(--border-color); position: relative; display: flex; flex-direction: column;
        }
        .property-card:hover { transform: translateY(-10px); box-shadow: var(--shadow-lg); }
        .card-img-container { height: 240px; overflow: hidden; position: relative; }
        .card-img-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s; }
        .property-card:hover .card-img-container img { transform: scale(1.1); }
        
        .card-badge {
            position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px);
            color: var(--primary-gold); padding: 0.3rem 1rem; border-radius: 30px; font-weight: 600; font-size: 0.8rem;
            border: 1px solid var(--primary-gold);
        }
        .favorite-btn {
            position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.9);
            width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s; border: none; color: #ff4757;
        }
        .favorite-btn.active { background: #ff4757; color: white; }
        
        .card-details { padding: 1.5rem; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .card-price { color: var(--primary-gold); font-size: 1.4rem; font-weight: 700; margin: 0.5rem 0; }
        .card-meta { display: flex; gap: 15px; color: #777; font-size: 0.9rem; margin-top: auto; padding-top: 1rem; border-top: 1px solid var(--border-color); }
        .card-meta span { display: flex; align-items: center; gap: 5px; }

        /* ===== LISTINGS PAGE (Advanced Filters) ===== */
        .listings-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;
        }
        .view-toggle { display: flex; gap: 10px; }
        .view-btn { padding: 0.5rem 1rem; border: 1px solid var(--border-color); background: var(--card-bg); cursor: pointer; }
        .view-btn.active { background: var(--primary-gold); color: #000; border-color: var(--primary-gold); }
        
        .listings-layout { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; }
        .filters-sidebar {
            background: var(--card-bg); padding: 1.5rem; border-radius: 12px; height: fit-content;
            border: 1px solid var(--border-color); position: sticky; top: 100px;
        }
        .filter-group { margin-bottom: 1.5rem; }
        .filter-group h4 { font-size: 1rem; margin-bottom: 0.8rem; color: var(--primary-gold); font-family: 'Inter', sans-serif; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .checkbox-group { display: flex; flex-direction: column; gap: 0.5rem; max-height: 200px; overflow-y: auto; }
        .checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; cursor: pointer; }
        .checkbox-item input { width: auto; }
        
        .tag-cloud { display: flex; flex-wrap: wrap; gap: 8px; }
        .filter-tag {
            padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; border: 1px solid var(--border-color);
            cursor: pointer; transition: 0.3s; background: var(--gray-bg);
        }
        .filter-tag.active { background: var(--primary-gold); color: #000; border-color: var(--primary-gold); }

        .price-slider { padding: 1rem 0; }
        .price-inputs { display: flex; gap: 10px; margin-top: 10px; }
        .price-inputs input { flex: 1; }

        /* ===== MAP VIEW ===== */
        .map-container {
            height: 500px; border-radius: 12px; overflow: hidden; border: 1px solid var(--border-color);
            position: relative; display: none;
        }
        .map-container.active { display: block; }
        .map-overlay {
            position: absolute; top: 20px; left: 20px; background: var(--card-bg); padding: 1rem;
            border-radius: 8px; box-shadow: var(--shadow); max-width: 300px; z-index: 1000;
        }

        /* ===== PROPERTY DETAIL PAGE ===== */
        .property-gallery {
            display: grid; grid-template-columns: 2fr 1fr; gap: 10px; margin-bottom: 2rem; height: 500px;
        }
        .gallery-main { border-radius: 12px; overflow: hidden; }
        .gallery-main img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-thumbs { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .gallery-thumb { border-radius: 8px; overflow: hidden; height: calc(50% - 5px); cursor: pointer; }
        .gallery-thumb img { width: 100%; height: 100%; object-fit: cover; }

        .property-highlights {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0;
        }
        .highlight-card {
            background: var(--gray-bg); padding: 1.5rem; border-radius: 8px; text-align: center;
        }
        .highlight-card i { font-size: 2rem; color: var(--primary-gold); margin-bottom: 1rem; }

        .floor-plan { background: var(--gray-bg); padding: 2rem; border-radius: 12px; margin: 2rem 0; text-align: center; }
        .virtual-tour { aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; margin: 2rem 0; }
        .virtual-tour iframe { width: 100%; height: 100%; border: none; }

        /* ===== DASHBOARD STYLES ===== */
        .dashboard-layout { display: flex; min-height: 100vh; background: var(--gray-bg); }
        .dash-sidebar {
            width: var(--sidebar-width); background: #000; color: #fff; position: fixed; height: 100%;
            display: flex; flex-direction: column; z-index: 900; overflow-y: auto;
        }
        .dash-profile { padding: 2rem; text-align: center; border-bottom: 1px solid #222; background: #111; }
        .dash-avatar {
            width: 70px; height: 70px; background: linear-gradient(135deg, var(--primary-gold), var(--dark-gold));
            border-radius: 50%; margin: 0 auto 1rem; display: flex; align-items: center; justify-content: center;
            font-size: 1.8rem; color: #000; font-weight: bold;
        }
        .dash-menu { padding: 1rem; flex: 1; overflow-y: auto; }
        .dash-menu a {
            display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: #aaa; text-decoration: none;
            margin-bottom: 5px; border-radius: 8px; transition: 0.3s; font-size: 0.9rem;
        }
        .dash-menu a:hover, .dash-menu a.active { background: rgba(212, 175, 55, 0.15); color: var(--primary-gold); }
        .dash-menu .section-head { font-size: 0.75rem; color: #555; margin: 15px 20px 5px; font-weight: 700; letter-spacing: 1px; }

        .dash-main { margin-left: var(--sidebar-width); flex: 1; padding: 2rem; max-width: 1600px; width: 100%; }
        .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        
        /* Dashboard Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; }
        .stat-card {
            background: var(--card-bg); padding: 1.5rem; border-radius: 12px; border: 1px solid var(--border-color);
            display: flex; align-items: center; gap: 1.5rem; box-shadow: var(--shadow); transition: var(--transition);
        }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-icon {
            width: 60px; height: 60px; background: rgba(212, 175, 55, 0.1); border-radius: 12px;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--primary-gold);
        }
        
        .chart-container { background: var(--card-bg); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; }
        
        .kanban-board {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 2rem;
        }
        .kanban-column { background: var(--gray-bg); padding: 1rem; border-radius: 8px; min-height: 400px; }
        .kanban-item {
            background: var(--card-bg); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;
            border: 1px solid var(--border-color); cursor: move;
        }

        .admin-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .admin-card {
            background: var(--card-bg); border-radius: 10px; border: 1px solid var(--border-color); padding: 1rem;
            display: flex; gap: 1rem; align-items: center; transition: 0.3s;
        }
        .admin-card:hover { transform: translateY(-3px); border-color: var(--primary-gold); }
        .admin-card img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }
        .admin-actions { margin-left: auto; display: flex; flex-direction: column; gap: 5px; }

        /* ===== MULTI-STEP FORMS ===== */
        .step-form { max-width: 800px; margin: 0 auto; }
        .step-indicator {
            display: flex; justify-content: space-between; margin-bottom: 3rem; position: relative;
        }
        .step-indicator:before {
            content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 2px; background: var(--border-color);
            z-index: 1;
        }
        .step {
            display: flex; flex-direction: column; align-items: center; position: relative; z-index: 2;
        }
        .step-number {
            width: 40px; height: 40px; border-radius: 50%; background: var(--gray-bg); border: 2px solid var(--border-color);
            display: flex; align-items: center; justify-content: center; font-weight: bold; margin-bottom: 10px;
            transition: 0.3s;
        }
        .step.active .step-number { background: var(--primary-gold); border-color: var(--primary-gold); color: #000; }
        .step.completed .step-number { background: #4CAF50; border-color: #4CAF50; color: white; }
        .step-label { font-size: 0.9rem; color: #777; }
        
        .step-content { display: none; }
        .step-content.active { display: block; }
        
        .form-actions { display: flex; justify-content: space-between; margin-top: 2rem; }

        /* ===== MODALS ===== */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; display: none; align-items: center; justify-content: center;
            backdrop-filter: blur(5px); padding: 1rem;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: var(--card-bg); padding: 2.5rem; border-radius: 16px; width: 90%; max-width: 500px;
            position: relative; border: 1px solid var(--primary-gold); box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            max-height: 90vh; overflow-y: auto;
        }
        .close-modal { position: absolute; top: 1.5rem; right: 1.5rem; font-size: 1.5rem; cursor: pointer; color: #888; transition: 0.3s; }
        .close-modal:hover { color: var(--primary-gold); }

        .auth-tabs { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .auth-tab {
            flex: 1; padding: 1rem; text-align: center; cursor: pointer; color: #888; font-weight: 600;
            border-bottom: 2px solid transparent; transition: 0.3s;
        }
        .auth-tab.active { color: var(--primary-gold); border-bottom-color: var(--primary-gold); }

        /* ===== UTILITIES ===== */
        .d-none { display: none !important; }
        .d-block { display: block !important; }
        .d-flex { display: flex !important; }
        .text-center { text-align: center; }
        .mt-2 { margin-top: 2rem; }
        .mb-2 { margin-bottom: 2rem; }
        .text-gold { color: var(--primary-gold); }
        .badge {
            padding: 4px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600;
            display: inline-block; margin-left: 8px;
        }
        .badge-success { background: #4CAF50; color: white; }
        .badge-warning { background: #ff9800; color: white; }
        .badge-danger { background: #f44336; color: white; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .listings-layout { grid-template-columns: 1fr; }
            .filters-sidebar { position: static; }
            .property-gallery { grid-template-columns: 1fr; height: auto; }
            .gallery-thumbs { grid-template-columns: repeat(4, 1fr); }
        }

        @media (max-width: 900px) {
            .nav-menu { display: none; position: fixed; top: 80px; left: 0; right: 0; background: var(--dark-bg);
                flex-direction: column; padding: 2rem; gap: 1rem; }
            .nav-menu.active { display: flex; }
            .mobile-menu-btn { display: block; }
            .search-form { grid-template-columns: 1fr; }
            .dash-sidebar { display: none; }
            .dash-main { margin-left: 0; }
            .hero h1 { font-size: 2.5rem; }
            .kanban-board { grid-template-columns: 1fr; }
        }

        @media (max-width: 600px) {
            .container { padding: 2rem 1rem; }
            .stats-grid { grid-template-columns: 1fr; }
            .admin-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-theme="light">

    <!-- Notification System -->
    <div id="notificationContainer"></div>

    <!-- NAVIGATION -->
    <nav class="navbar" id="mainNav">
        <div class="nav-container">
            <div class="logo" onclick="app.route('home')">
                <i class="fas fa-gem"></i> AURUM
            </div>
            
            <button class="mobile-menu-btn" onclick="app.toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-menu" id="navMenu">
                <a href="#" onclick="app.route('home')" class="active">Home</a>
                <a href="#" onclick="app.route('listings')">Listings</a>
                <a href="#" onclick="app.route('compare')">Compare</a>
                <a href="#" onclick="app.route('mortgage')">Mortgage</a>
                <a href="#" onclick="app.route('agents')">Agents</a>
                <a href="#" onclick="app.route('blog')">Blog</a>
                
                <button class="theme-btn" onclick="app.toggleTheme()"><i class="fas fa-moon"></i></button>
                <div id="authBtnContainer">
                    <button class="btn-primary" onclick="app.openModal('visitorModal')">Sign In</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Breadcrumbs -->
    <div class="breadcrumb d-none" id="breadcrumb">
        <a href="#" onclick="app.route('home')">Home</a> > <span id="breadcrumbCurrent">Listings</span>
    </div>

    <!-- MAIN APPLICATION CONTENT -->
    <div id="app-content">
        
        <!-- HOME PAGE -->
        <div id="view-home" class="view-section animate-up">
            <section class="hero">
                <video autoplay muted loop playsinline>
                    <source src="https://videos.pexels.com/video-files/3773487/3773487-uhd_2560_1440_25fps.mp4" type="video/mp4">
                </video>
                <div class="hero-overlay">
                    <h1>Where Value Meets Vision</h1>
                    <p style="color:#eee; font-size:1.2rem; margin-bottom:2rem;">Explore Zimbabwe's Premier Real Estate Portfolio</p>
                    <button class="btn-primary" onclick="app.route('listings')">Explore Properties</button>
                </div>
            </section>
            
            <!-- Search Bar -->
            <div class="search-bar animate-up stagger-1">
                <form class="search-form" onsubmit="app.handleSearch(event)">
                    <div style="position: relative;">
                        <input type="text" id="globalSearch" placeholder="Search: '3 bedroom house in Harare under $300k'" 
                               oninput="app.showSearchSuggestions()">
                        <div class="search-suggestions" id="searchSuggestions"></div>
                    </div>
                    <select id="searchType">
                        <option value="all">All Types</option>
                        <option value="house">House</option>
                        <option value="apartment">Apartment</option>
                        <option value="commercial">Commercial</option>
                        <option value="land">Land</option>
                    </select>
                    <select id="searchProvince">
                        <option value="all">All Provinces</option>
                        <option value="Harare">Harare</option>
                        <option value="Bulawayo">Bulawayo</option>
                        <option value="Manicaland">Manicaland</option>
                        <option value="Mashonaland East">Mashonaland East</option>
                        <option value="Mashonaland West">Mashonaland West</option>
                        <option value="Mashonaland Central">Mashonaland Central</option>
                        <option value="Midlands">Midlands</option>
                    </select>
                    <select id="searchStatus">
                        <option value="all">All Status</option>
                        <option value="buy">For Sale</option>
                        <option value="rent">For Rent</option>
                        <option value="auction">Auction</option>
                    </select>
                    <button type="submit" class="btn-primary"><i class="fas fa-search"></i> Search</button>
                </form>
            </div>
            
            <div class="container">
                <h2 class="section-title">Featured Collections</h2>
                <div class="property-grid" id="featuredGrid"></div>
                
                <div class="text-center mt-2">
                    <button class="btn-outline" onclick="app.route('listings')">View All Properties</button>
                </div>
            </div>
            
            <!-- Statistics Section -->
            <div style="background: var(--gray-bg); padding: 4rem 2rem;">
                <div class="container">
                    <h2 class="section-title">Market Insights</h2>
                    <div class="stats-grid">
                        <div class="stat-card animate-up stagger-1">
                            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                            <div><h3 style="font-size:1.8rem;">15%</h3><p style="color:#777;">Price Growth (YoY)</p></div>
                        </div>
                        <div class="stat-card animate-up stagger-2">
                            <div class="stat-icon"><i class="fas fa-home"></i></div>
                            <div><h3 style="font-size:1.8rem;">1,247</h3><p style="color:#777;">Properties Listed</p></div>
                        </div>
                        <div class="stat-card animate-up stagger-3">
                            <div class="stat-icon"><i class="fas fa-user-check"></i></div>
                            <div><h3 style="font-size:1.8rem;">98%</h3><p style="color:#777;">Client Satisfaction</p></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- LISTINGS PAGE -->
        <div id="view-listings" class="view-section d-none" style="padding-top:100px;">
            <div class="container">
                <div class="listings-header">
                    <h2>Properties For Sale & Rent</h2>
                    <div style="display:flex; gap:1rem; align-items:center;">
                        <div class="view-toggle">
                            <button class="view-btn active" onclick="app.setViewMode('grid')"><i class="fas fa-th-large"></i></button>
                            <button class="view-btn" onclick="app.setViewMode('list')"><i class="fas fa-list"></i></button>
                            <button class="view-btn" onclick="app.setViewMode('map')"><i class="fas fa-map"></i></button>
                        </div>
                        <select onchange="app.sortListings(this.value)" style="width:200px;">
                            <option value="newest">Newest First</option>
                            <option value="price_asc">Price: Low to High</option>
                            <option value="price_desc">Price: High to Low</option>
                            <option value="area">Largest Area</option>
                        </select>
                    </div>
                </div>
                
                <!-- Map View -->
                <div class="map-container" id="mapView">
                    <div class="map-overlay">
                        <h4>Property Map</h4>
                        <p>Click on markers to view details</p>
                    </div>
                    <!-- Map would be implemented with Google Maps API -->
                </div>
                
                <!-- Grid/List View -->
                <div class="listings-layout" id="listingsView">
                    <!-- ADVANCED FILTER SIDEBAR -->
                    <aside class="filters-sidebar animate-up">
                        <h3 style="margin-bottom:1.5rem;">Filter Properties</h3>
                        
                        <div class="filter-group">
                            <h4>Search</h4>
                            <input type="text" id="fSearch" placeholder="Address, keyword..." oninput="app.filterListings()">
                        </div>

                        <div class="filter-group">
                            <h4>Status</h4>
                            <select id="fStatus" onchange="app.filterListings()">
                                <option value="all">All</option>
                                <option value="buy">For Sale</option>
                                <option value="rent">For Rent</option>
                                <option value="auction">Auction</option>
                                <option value="foreclosure">Foreclosure</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <h4>Price Range (USD)</h4>
                            <div class="price-slider">
                                <input type="range" id="fPriceMin" min="0" max="1000000" step="10000" style="width:100%" oninput="app.updatePriceRange()">
                                <input type="range" id="fPriceMax" min="0" max="1000000" step="10000" style="width:100%" oninput="app.updatePriceRange()">
                                <div class="price-inputs">
                                    <input type="number" id="fPriceMinVal" placeholder="Min" onchange="app.filterListings()">
                                    <input type="number" id="fPriceMaxVal" placeholder="Max" onchange="app.filterListings()">
                                </div>
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4>Location</h4>
                            <select id="fProvince" style="margin-bottom:10px;" onchange="app.populateTowns(); app.filterListings()">
                                <option value="all">All Provinces</option>
                                <option value="Harare">Harare</option>
                                <option value="Bulawayo">Bulawayo</option>
                                <option value="Manicaland">Manicaland</option>
                                <option value="Mashonaland East">Mashonaland East</option>
                                <option value="Mashonaland West">Mashonaland West</option>
                                <option value="Mashonaland Central">Mashonaland Central</option>
                                <option value="Midlands">Midlands</option>
                                <option value="Masvingo">Masvingo</option>
                                <option value="Matabeleland North">Matabeleland North</option>
                                <option value="Matabeleland South">Matabeleland South</option>
                            </select>
                            <select id="fTown" onchange="app.filterListings()" disabled>
                                <option value="all">All Towns</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <h4>Property Type</h4>
                            <div class="checkbox-group">
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="House" onchange="app.filterListings()"> House</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Apartment" onchange="app.filterListings()"> Apartment</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Townhouse" onchange="app.filterListings()"> Townhouse</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Commercial" onchange="app.filterListings()"> Commercial</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Industrial" onchange="app.filterListings()"> Industrial</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Farm" onchange="app.filterListings()"> Farm</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Land" onchange="app.filterListings()"> Land</label>
                                <label class="checkbox-item"><input type="checkbox" class="fType" value="Lodge" onchange="app.filterListings()"> Lodge</label>
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4>Bedrooms</h4>
                            <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                <button class="filter-tag" onclick="app.toggleBedFilter('1')">1+</button>
                                <button class="filter-tag" onclick="app.toggleBedFilter('2')">2+</button>
                                <button class="filter-tag" onclick="app.toggleBedFilter('3')">3+</button>
                                <button class="filter-tag" onclick="app.toggleBedFilter('4')">4+</button>
                                <button class="filter-tag" onclick="app.toggleBedFilter('5')">5+</button>
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4>Amenities</h4>
                            <div class="tag-cloud" id="tagCloudFilter">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <div class="filter-group">
                            <h4>Year Built</h4>
                            <select id="fYear" onchange="app.filterListings()">
                                <option value="all">Any Year</option>
                                <option value="2020">2020+</option>
                                <option value="2010">2010+</option>
                                <option value="2000">2000+</option>
                                <option value="1990">1990+</option>
                            </select>
                        </div>

                        <button class="btn-primary" style="width:100%;" onclick="app.resetFilters()">Reset Filters</button>
                    </aside>

                    <!-- LISTINGS GRID -->
                    <main>
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
                            <h3 id="resultCount">Loading properties...</h3>
                            <span id="saveSearch" style="color:var(--primary-gold); cursor:pointer;" onclick="app.saveSearch()">
                                <i class="fas fa-bookmark"></i> Save Search
                            </span>
                        </div>
                        <div class="property-grid" id="listingsGrid"></div>
                        <div id="pagination" class="text-center mt-2"></div>
                    </main>
                </div>
            </div>
        </div>

        <!-- PROPERTY DETAIL PAGE -->
        <div id="view-detail" class="view-section d-none" style="padding-top:100px;">
            <div class="container" style="max-width:1200px;">
                <div id="detailContent"></div>
            </div>
        </div>

        <!-- MORTGAGE CALCULATOR -->
        <div id="view-mortgage" class="view-section d-none" style="padding-top:100px;">
            <div class="container">
                <h2 class="section-title">Mortgage Calculator</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 3rem;">
                    <div class="stat-card" style="display:block;">
                        <h3 style="margin-bottom:1.5rem;">Calculate Your Mortgage</h3>
                        <div class="form-group">
                            <label>Property Price (USD)</label>
                            <input type="number" id="mortgagePrice" value="300000" oninput="app.calculateMortgage()">
                        </div>
                        <div class="form-group">
                            <label>Down Payment (%)</label>
                            <input type="range" id="downPayment" min="10" max="50" step="5" value="20" oninput="app.calculateMortgage()">
                            <div id="downPaymentVal" style="text-align:center; margin-top:5px;">20%</div>
                        </div>
                        <div class="form-group">
                            <label>Loan Term (Years)</label>
                            <select id="loanTerm" onchange="app.calculateMortgage()">
                                <option value="15">15 Years</option>
                                <option value="20" selected>20 Years</option>
                                <option value="25">25 Years</option>
                                <option value="30">30 Years</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Interest Rate (%)</label>
                            <input type="range" id="interestRate" min="1" max="10" step="0.1" value="6.5" oninput="app.calculateMortgage()">
                            <div id="interestRateVal" style="text-align:center; margin-top:5px;">6.5%</div>
                        </div>
                    </div>
                    <div>
                        <div class="stat-card" style="display:block;">
                            <h3 style="margin-bottom:1.5rem;">Payment Summary</h3>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="text-align:center; padding:1rem; background:var(--gray-bg); border-radius:8px;">
                                    <div style="font-size:0.9rem; color:#777;">Monthly Payment</div>
                                    <div id="monthlyPayment" style="font-size:2rem; color:var(--primary-gold); font-weight:bold;">$1,728</div>
                                </div>
                                <div style="text-align:center; padding:1rem; background:var(--gray-bg); border-radius:8px;">
                                    <div style="font-size:0.9rem; color:#777;">Total Interest</div>
                                    <div id="totalInterest" style="font-size:2rem; color:var(--primary-gold); font-weight:bold;">$114,720</div>
                                </div>
                            </div>
                            <div style="margin-bottom:1rem;">
                                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
                                    <span>Loan Amount:</span>
                                    <span id="loanAmount">$240,000</span>
                                </div>
                                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
                                    <span>Down Payment:</span>
                                    <span id="downPaymentAmount">$60,000</span>
                                </div>
                                <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
                                    <span>Total of Payments:</span>
                                    <span id="totalPayments">$414,720</span>
                                </div>
                            </div>
                            <canvas id="mortgageChart" height="100"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PROPERTY COMPARISON -->
        <div id="view-compare" class="view-section d-none" style="padding-top:100px;">
            <div class="container">
                <h2 class="section-title">Compare Properties</h2>
                <div id="compareContainer">
                    <div style="text-align:center; padding:3rem; background:var(--gray-bg); border-radius:12px;">
                        <i class="fas fa-exchange-alt" style="font-size:3rem; color:#ccc; margin-bottom:1rem;"></i>
                        <h3>Select Properties to Compare</h3>
                        <p style="color:#777; margin-bottom:2rem;">Choose 2-4 properties from the listings page</p>
                        <button class="btn-primary" onclick="app.route('listings')">Browse Properties</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- AGENTS DIRECTORY -->
        <div id="view-agents" class="view-section d-none" style="padding-top:100px;">
            <div class="container">
                <h2 class="section-title">Our Agents</h2>
                <div class="admin-grid" id="agentsGrid"></div>
            </div>
        </div>

        <!-- BLOG/NEWS -->
        <div id="view-blog" class="view-section d-none" style="padding-top:100px;">
            <div class="container">
                <h2 class="section-title">Market Insights & News</h2>
                <div class="property-grid" id="blogGrid"></div>
            </div>
        </div>

    </div>

    <!-- DASHBOARD PANEL -->
    <div id="dashboard-panel" class="dashboard-layout d-none">
        <aside class="dash-sidebar">
            <div class="dash-profile">
                <div class="dash-avatar" id="dashInitials">AD</div>
                <h4 id="dashName">Admin Name</h4>
                <small id="dashRole" style="color:var(--primary-gold); text-transform:uppercase; letter-spacing:1px; font-size:0.7rem;">Role</small>
            </div>
            <nav class="dash-menu">
                <div class="section-head">MAIN</div>
                <a href="#" onclick="app.loadDash('overview')" class="active"><i class="fas fa-chart-pie"></i> Overview</a>
                <a href="#" onclick="app.route('home')"><i class="fas fa-globe"></i> View Website</a>
                
                <div class="section-head">PROPERTIES</div>
                <a href="#" onclick="app.loadDash('add')"><i class="fas fa-plus-circle"></i> Add Property</a>
                <a href="#" onclick="app.loadDash('manage')"><i class="fas fa-list-ul"></i> Manage Listings</a>
                <a href="#" onclick="app.loadDash('kanban')"><i class="fas fa-columns"></i> Sales Pipeline</a>
                
                <div class="section-head">TEAM</div>
                <a href="#" onclick="app.loadDash('team')"><i class="fas fa-users"></i> Team Management</a>
                <a href="#" onclick="app.loadDash('performance')"><i class="fas fa-trophy"></i> Performance</a>
                
                <div id="ownerMenu" class="d-none">
                    <div class="section-head">OWNER CONTROLS</div>
                    <a href="#" onclick="app.loadDash('requests')"><i class="fas fa-user-clock"></i> Access Requests</a>
                    <a href="#" onclick="app.loadDash('analytics')"><i class="fas fa-chart-line"></i> Advanced Analytics</a>
                    <a href="#" onclick="app.loadDash('settings')"><i class="fas fa-cog"></i> System Settings</a>
                </div>

                <div style="margin-top:auto; border-top:1px solid #333; padding-top:1rem;">
                    <a href="#" onclick="app.logout()" style="color:#e74c3c;"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
                </div>
            </nav>
        </aside>

        <main class="dash-main" id="dashContent">
            <!-- Content injected via JS -->
        </main>
    </div>

    <!-- MODALS -->
    
    <!-- VISITOR MODAL -->
    <div id="visitorModal" class="modal">
        <div class="modal-content animate-up">
            <span class="close-modal" onclick="app.closeModal('visitorModal')">&times;</span>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="app.switchVisitorTab('login')">Login</div>
                <div class="auth-tab" onclick="app.switchVisitorTab('signup')">Sign Up</div>
            </div>

            <div id="visitorLogin" class="step-content active">
                <h3 style="margin-bottom:1rem;">Visitor Login</h3>
                <div class="form-group">
                    <input type="email" id="vEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="vPass" placeholder="Password" required>
                </div>
                <button class="btn-primary" style="width:100%; margin-bottom:1rem;" onclick="app.handleVisitorLogin()">Log In</button>
                <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
                    <a href="#" onclick="app.showForgotPassword()">Forgot Password?</a>
                    <a href="#" onclick="app.switchToStaffModal()">Staff Access</a>
                </div>
            </div>

            <div id="visitorSignup" class="step-content">
                <h3 style="margin-bottom:1rem;">Create Account</h3>
                <div class="form-group">
                    <input type="text" id="vsName" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <input type="email" id="vsEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="tel" id="vsPhone" placeholder="Phone Number" required>
                </div>
                <div class="form-group">
                    <input type="password" id="vsPass" placeholder="Password" required>
                </div>
                <div class="form-group">
                    <input type="password" id="vsPassConfirm" placeholder="Confirm Password" required>
                </div>
                <button class="btn-primary" style="width:100%; margin-bottom:1rem;" onclick="app.handleVisitorSignup()">Create Account</button>
                <p style="font-size:0.8rem; color:#666; text-align:center;">
                    By signing up, you agree to our Terms of Service and Privacy Policy
                </p>
            </div>

            <div id="visitorForgot" class="step-content">
                <h3 style="margin-bottom:1rem;">Reset Password</h3>
                <p style="margin-bottom:1rem; color:#666;">Enter your email to receive a password reset link</p>
                <div class="form-group">
                    <input type="email" id="resetEmail" placeholder="Your Email" required>
                </div>
                <button class="btn-primary" style="width:100%; margin-bottom:1rem;" onclick="app.handlePasswordReset()">Send Reset Link</button>
                <a href="#" style="font-size:0.9rem; display:block; text-align:center;" onclick="app.switchVisitorTab('login')">Back to Login</a>
            </div>
        </div>
    </div>

    <!-- STAFF MODAL -->
    <div id="staffModal" class="modal">
        <div class="modal-content animate-up">
            <span class="close-modal" onclick="app.closeModal('staffModal')">&times;</span>
            
            <div class="auth-tabs">
                <div class="auth-tab active" onclick="app.switchStaffTab('login')">Staff Login</div>
                <div class="auth-tab" onclick="app.switchStaffTab('request')">Request Access</div>
            </div>

            <div id="staffLogin" class="step-content active">
                <h3 style="margin-bottom:1rem;">Staff Portal</h3>
                <p style="font-size:0.8rem; color:#666; margin-bottom:1rem;">Access for team members only</p>
                <div class="form-group">
                    <input type="email" id="sEmail" placeholder="Staff Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="sPass" placeholder="Password" required>
                </div>
                <div class="form-group">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="twoFactor"> Enable Two-Factor Authentication
                    </label>
                </div>
                <button class="btn-primary" style="width:100%; margin-bottom:1rem;" onclick="app.handleStaffLogin()">Access Dashboard</button>
                <a href="#" style="font-size:0.9rem; display:block; text-align:center;" onclick="app.switchToVisitorModal()">Visitor Access</a>
            </div>

            <div id="staffRequest" class="step-content">
                <h3 style="margin-bottom:1rem;">Request Staff Access</h3>
                <p style="font-size:0.8rem; color:#666; margin-bottom:1rem;">Your request will be reviewed by management</p>
                
                <div class="form-group">
                    <input type="text" id="srName" placeholder="Full Name" required>
                </div>
                <div class="form-group">
                    <input type="email" id="srEmail" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="tel" id="srPhone" placeholder="Phone Number" required>
                </div>
                <div class="form-group">
                    <select id="srRole" required>
                        <option value="">Select Role</option>
                        <option value="agent">Real Estate Agent</option>
                        <option value="manager">Property Manager</option>
                        <option value="admin">Administrator</option>
                        <option value="marketing">Marketing Specialist</option>
                    </select>
                </div>
                <div class="form-group">
                    <textarea id="srExperience" placeholder="Previous experience (optional)" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Upload CV (Optional)</label>
                    <input type="file" id="srCV" accept=".pdf,.doc,.docx">
                </div>
                <div class="form-group">
                    <textarea id="srReason" placeholder="Why do you want access? What will you use it for?" required rows="3"></textarea>
                </div>
                <button class="btn-primary" style="width:100%; margin-bottom:1rem;" onclick="app.handleAccessRequest()">Submit Request</button>
            </div>
        </div>
    </div>

    <!-- PROPERTY ADD/EDIT MODAL -->
    <div id="propertyModal" class="modal">
        <div class="modal-content animate-up" style="max-width:800px;">
            <span class="close-modal" onclick="app.closeModal('propertyModal')">&times;</span>
            <h2 id="propertyModalTitle" style="margin-bottom:2rem;">Add New Property</h2>
            <div class="step-form" id="propertyForm"></div>
        </div>
    </div>

    <script>
        const app = {
            // ===== DATA STORE =====
            data: {
                users: [
                    { id: 1, name: 'Owner User', email: 'owner@aurum.co.zw', password: '123', role: 'owner', phone: '+263771234567', verified: true },
                    { id: 2, name: 'Admin User', email: 'admin@aurum.co.zw', password: '123', role: 'admin', phone: '+263772345678', verified: true },
                    { id: 3, name: 'John Doe', email: 'visitor@gmail.com', password: '123', role: 'visitor', phone: '+263773456789', verified: true }
                ],
                accessRequests: [],
                savedSearches: [],
                favorites: [],
                properties: [
                    // Luxury Properties (5)
                    { id: 101, title: 'Luxury Golf Estate', price: 1250000, type: 'House', status: 'buy', beds: 5, baths: 4, area: 2500, year: 2020, 
                      province: 'Harare', town: 'Borrowdale', address: '12 Golf Course Rd', 
                      desc: 'A stunning masterpiece overlooking the greens of the prestigious Borrowdale Brooke Golf Course. Features a gourmet kitchen, wine cellar, home theater, and infinity pool.',
                      tags: ['Golf View', 'Solar', 'Pool', 'Security', 'Wine Cellar', 'Home Theater'], 
                      images: [
                          'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800',
                          'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800',
                          'https://images.unsplash.com/photo-1600607687644-c7171b42498b?w=800'
                      ],
                      virtualTour: 'https://www.youtube.com/embed/example',
                      mapLink: 'https://goo.gl/maps/example',
                      featured: true
                    },
                    { id: 102, title: 'Modern Penthouse', price: 850000, type: 'Apartment', status: 'buy', beds: 3, baths: 3, area: 280, year: 2022,
                      province: 'Harare', town: 'Avondale', address: '50 King George Avenue',
                      desc: 'Sophisticated penthouse with panoramic city views, smart home automation, and premium finishes.',
                      tags: ['City View', 'Smart Home', 'Balcony', 'Security', 'Gym'],
                      images: [
                          'https://images.unsplash.com/photo-1512917774080-9991f1c4c750?w=800',
                          'https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=800'
                      ],
                      featured: true
                    },
                    // Middle Market (8)
                    { id: 103, title: 'Family Home Highlands', price: 320000, status: 'buy', type: 'House', beds: 4, baths: 3, area: 800, year: 2015, 
                      province: 'Harare', town: 'Highlands', address: 'Glen Livet Rd',
                      desc: 'Spacious family home with mature gardens, staff quarters, and ample parking.',
                      tags: ['Garden', 'Borehole', 'Staff Quarters', 'Parking', 'Solar'],
                      images: ['https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800'],
                      featured: true
                    },
                    { id: 104, title: 'Waterfalls Townhouse', price: 1800, status: 'rent', type: 'Townhouse', beds: 3, baths: 2, area: 150, year: 2018,
                      province: 'Harare', town: 'Waterfalls', address: '23 Willow Road',
                      desc: 'Modern townhouse in gated community with shared pool and security.',
                      tags: ['Gated Community', 'Pool', 'Security', 'Parking'],
                      images: ['https://images.unsplash.com/photo-1518780664697-55e3ad937233?w=800']
                    },
                    // Commercial (4)
                    { id: 105, title: 'CBD Office Space', price: 450000, status: 'buy', type: 'Commercial', beds: 0, baths: 4, area: 1200, year: 2010,
                      province: 'Harare', town: 'CBD', address: 'Jason Moyo Avenue',
                      desc: 'Prime office space in central business district with fiber internet and parking.',
                      tags: ['Fiber Internet', 'Parking', 'Security', 'Elevator'],
                      images: ['https://images.unsplash.com/photo-1497366754035-f200968a6e72?w=800']
                    },
                    // Unique Listings (3)
                    { id: 106, title: 'Kariba Lake House', price: 750000, status: 'buy', type: 'House', beds: 6, baths: 5, area: 5000, year: 2005,
                      province: 'Mashonaland West', town: 'Kariba', address: 'Lakeview Drive',
                      desc: 'Stunning lakefront property with private jetty and breathtaking sunset views.',
                      tags: ['Lakefront', 'Private Jetty', 'Pool', 'Borehole', 'Generator'],
                      images: ['https://images.unsplash.com/photo-1513584684374-8bab748fbf90?w=800']
                    },
                    // More sample properties...
                    { id: 107, title: 'Mount Pleasant Family Home', price: 275000, status: 'buy', type: 'House', beds: 3, baths: 2, area: 600, year: 2012,
                      province: 'Harare', town: 'Mount Pleasant', address: '15 Jacaranda Lane',
                      desc: 'Lovely family home in quiet neighborhood close to schools.',
                      tags: ['Quiet Area', 'Schools Nearby', 'Garden', 'Parking'],
                      images: ['https://images.unsplash.com/photo-1568605114967-8130f3a36994?w=800']
                    },
                    { id: 108, title: 'Eastlea Apartment', price: 950, status: 'rent', type: 'Apartment', beds: 2, baths: 2, area: 90, year: 2020,
                      province: 'Harare', town: 'Eastlea', address: 'Flat 3, Eastlea Gardens',
                      desc: 'Modern apartment with built-in appliances and balcony.',
                      tags: ['Built-in Appliances', 'Balcony', 'Security', 'Parking'],
                      images: ['https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=800']
                    }
                ],
                agents: [
                    { id: 1, name: 'Vincent Chimoto', role: 'Senior Agent', phone: '+263714384521', email: 'vincent@aurum.co.zw', 
                      image: 'https://img.sanishtech.com/u/731f6cfaafa5a354cce045f2cece89ed.jpg', properties: 42, rating: 4.7 },
                    { id: 2, name: 'Victor Makwarimba', role: 'Commercial Specialist', phone: '+263783455849', email: 'victor@aurum.co.zw',
                      image: 'https://img.sanishtech.com/u/b9ecf1015127b54431b39c12d9ce7805.jpg', properties: 72, rating: 4.9 }
                ],
                blogPosts: [
                    { id: 1, title: '2025 Zimbabwe Real Estate Market Outlook', date: '2025-11-15', category: 'Market Analysis',
                      excerpt: 'An in-depth analysis of current trends and future predictions for the Zimbabwe property market.',
                      image: 'https://images.unsplash.com/photo-1560518883-ce09059eeffa?w=800' },
                    { id: 2, title: 'Investment Opportunities in Victoria Falls', date: '2025-12-10', category: 'Investment',
                      excerpt: 'Exploring the growing tourism sector and property investment potential in Victoria Falls.',
                      image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800' }
                ],
                currentUser: null,
                viewMode: 'grid',
                currentFilters: {},
                currentPage: 1,
                itemsPerPage: 12
            },

            // ===== INITIALIZATION =====
            init: function() {
                // Load from localStorage
                this.loadData();
                
                // Check system theme preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.setAttribute('data-theme', 'dark');
                }
                
                // Check for saved theme
                const savedTheme = localStorage.getItem('aurumTheme');
                if (savedTheme) {
                    document.body.setAttribute('data-theme', savedTheme);
                }
                
                // Check for session
                const session = sessionStorage.getItem('aurumSession');
                if (session) {
                    const sessionData = JSON.parse(session);
                    this.data.currentUser = this.data.users.find(u => u.id === sessionData.userId);
                    if (this.data.currentUser) {
                        this.updateUI();
                        // Check if session expired
                        if (sessionData.expires < Date.now()) {
                            this.logout();
                        }
                    }
                }
                
                // Initial renders
                this.renderFeaturedProperties();
                this.renderAllListings();
                this.renderTagCloud();
                this.renderAgents();
                this.renderBlogPosts();
                this.setupEventListeners();
                
                // Show welcome notification
                this.showNotification('Welcome to Aurum Real Estate!', 'info');
            },

            loadData: function() {
                const saved = localStorage.getItem('aurumData');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // Merge with default data (preserve new properties if they don't exist)
                    Object.keys(parsed).forEach(key => {
                        if (this.data[key] && Array.isArray(this.data[key])) {
                            // For arrays, merge based on id
                            const existingIds = new Set(this.data[key].map(item => item.id));
                            parsed[key].forEach(item => {
                                if (!existingIds.has(item.id)) {
                                    this.data[key].push(item);
                                }
                            });
                        } else {
                            this.data[key] = parsed[key];
                        }
                    });
                }
            },

            saveData: function() {
                localStorage.setItem('aurumData', JSON.stringify(this.data));
            },

            // ===== ROUTING =====
            route: function(viewId, params) {
                // Hide all views
                document.querySelectorAll('.view-section').forEach(el => el.classList.add('d-none'));
                document.getElementById('dashboard-panel').classList.add('d-none');
                document.getElementById('app-content').classList.remove('d-none');
                document.getElementById('mainNav').classList.remove('d-none');
                document.getElementById('breadcrumb').classList.remove('d-none');
                document.body.style.overflow = 'auto';
                
                // Update navigation active state
                document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
                const navItem = document.querySelector(`.nav-menu a[onclick*="${viewId}"]`);
                if (navItem) navItem.classList.add('active');
                
                // Show target view
                const target = document.getElementById('view-' + viewId);
                target.classList.remove('d-none');
                
                // Update breadcrumb
                this.updateBreadcrumb(viewId, params);
                
                // Trigger animations
                target.classList.remove('animate-up');
                void target.offsetWidth;
                target.classList.add('animate-up');
                
                // Execute view-specific logic
                switch(viewId) {
                    case 'home':
                        this.renderFeaturedProperties();
                        break;
                    case 'listings':
                        this.renderAllListings();
                        break;
                    case 'detail':
                        if (params && params.id) {
                            this.renderPropertyDetail(params.id);
                        }
                        break;
                    case 'mortgage':
                        this.calculateMortgage();
                        break;
                }
                
                window.scrollTo(0, 0);
            },

            updateBreadcrumb: function(viewId, params) {
                const breadcrumb = document.getElementById('breadcrumbCurrent');
                const crumbs = {
                    'home': 'Home',
                    'listings': 'Properties',
                    'detail': 'Property Details',
                    'mortgage': 'Mortgage Calculator',
                    'compare': 'Compare Properties',
                    'agents': 'Our Agents',
                    'blog': 'Blog & News'
                };
                
                breadcrumb.textContent = crumbs[viewId] || viewId.charAt(0).toUpperCase() + viewId.slice(1);
                
                // Add property title for detail view
                if (viewId === 'detail' && params && params.id) {
                    const property = this.data.properties.find(p => p.id == params.id);
                    if (property) {
                        breadcrumb.textContent = property.title;
                    }
                }
            },

            // ===== AUTHENTICATION SYSTEM =====
            openModal: function(modalId) {
                document.getElementById(modalId).classList.add('active');
                document.body.style.overflow = 'hidden';
            },

            closeModal: function(modalId) {
                document.getElementById(modalId).classList.remove('active');
                document.body.style.overflow = 'auto';
            },

            switchVisitorTab: function(tab) {
                // Hide all visitor tabs
                document.querySelectorAll('#visitorModal .step-content').forEach(el => el.classList.remove('active'));
                // Show selected tab
                document.getElementById('visitor' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
                
                // Update tab headers
                document.querySelectorAll('#visitorModal .auth-tab').forEach(t => t.classList.remove('active'));
                if (tab === 'forgot') {
                    document.querySelector('#visitorModal .auth-tab:nth-child(1)').classList.add('active');
                } else {
                    document.querySelector(`#visitorModal .auth-tab[onclick*="${tab}"]`).classList.add('active');
                }
            },

            switchStaffTab: function(tab) {
                // Similar to switchVisitorTab
                document.querySelectorAll('#staffModal .step-content').forEach(el => el.classList.remove('active'));
                document.getElementById('staff' + tab.charAt(0).toUpperCase() + tab.slice(1)).classList.add('active');
                
                document.querySelectorAll('#staffModal .auth-tab').forEach(t => t.classList.remove('active'));
                document.querySelector(`#staffModal .auth-tab[onclick*="${tab}"]`).classList.add('active');
            },

            switchToStaffModal: function() {
                this.closeModal('visitorModal');
                this.openModal('staffModal');
            },

            switchToVisitorModal: function() {
                this.closeModal('staffModal');
                this.openModal('visitorModal');
            },

            showForgotPassword: function() {
                this.switchVisitorTab('forgot');
            },

            handleVisitorLogin: function() {
                const email = document.getElementById('vEmail').value;
                const password = document.getElementById('vPass').value;
                
                const user = this.data.users.find(u => 
                    u.email === email && u.password === password && u.role === 'visitor'
                );
                
                if (user) {
                    this.loginSuccess(user);
                } else {
                    this.showNotification('Invalid email or password', 'error');
                }
            },

            handleVisitorSignup: function() {
                const name = document.getElementById('vsName').value;
                const email = document.getElementById('vsEmail').value;
                const phone = document.getElementById('vsPhone').value;
                const password = document.getElementById('vsPass').value;
                const confirm = document.getElementById('vsPassConfirm').value;
                
                // Validation
                if (password !== confirm) {
                    this.showNotification('Passwords do not match', 'error');
                    return;
                }
                
                if (this.data.users.find(u => u.email === email)) {
                    this.showNotification('Email already registered', 'error');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: Date.now(),
                    name: name,
                    email: email,
                    phone: phone,
                    password: password,
                    role: 'visitor',
                    verified: false,
                    createdAt: new Date().toISOString()
                };
                
                this.data.users.push(newUser);
                this.saveData();
                
                // In a real app, send verification email here
                this.showNotification('Account created successfully! Please check your email for verification.', 'success');
                
                // Auto login
                this.loginSuccess(newUser);
            },

            handleStaffLogin: function() {
                const email = document.getElementById('sEmail').value;
                const password = document.getElementById('sPass').value;
                
                const user = this.data.users.find(u => 
                    u.email === email && u.password === password && (u.role === 'admin' || u.role === 'owner')
                );
                
                if (user) {
                    this.loginSuccess(user);
                } else {
                    this.showNotification('Invalid staff credentials or insufficient permissions', 'error');
                }
            },

            handleAccessRequest: function() {
                const request = {
                    id: Date.now(),
                    name: document.getElementById('srName').value,
                    email: document.getElementById('srEmail').value,
                    phone: document.getElementById('srPhone').value,
                    role: document.getElementById('srRole').value,
                    experience: document.getElementById('srExperience').value,
                    reason: document.getElementById('srReason').value,
                    status: 'pending',
                    date: new Date().toISOString()
                };
                
                this.data.accessRequests.push(request);
                this.saveData();
                
                this.showNotification('Access request submitted! We will review it shortly.', 'success');
                this.closeModal('staffModal');
            },

            handlePasswordReset: function() {
                const email = document.getElementById('resetEmail').value;
                const user = this.data.users.find(u => u.email === email);
                
                if (user) {
                    // In a real app, send reset email here
                    this.showNotification('Password reset link sent to your email', 'success');
                    this.switchVisitorTab('login');
                } else {
                    this.showNotification('Email not found', 'error');
                }
            },

            loginSuccess: function(user) {
                this.data.currentUser = user;
                
                // Create session
                const session = {
                    userId: user.id,
                    expires: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
                };
                sessionStorage.setItem('aurumSession', JSON.stringify(session));
                
                this.updateUI();
                this.closeModal('visitorModal');
                this.closeModal('staffModal');
                
                // Redirect based on role
                if (user.role === 'owner' || user.role === 'admin') {
                    this.loadDash('overview');
                } else {
                    this.showNotification(`Welcome back, ${user.name}!`, 'success');
                }
            },

            logout: function() {
                this.data.currentUser = null;
                sessionStorage.removeItem('aurumSession');
                this.updateUI();
                this.route('home');
                this.showNotification('Logged out successfully', 'info');
            },

            updateUI: function() {
                const authContainer = document.getElementById('authBtnContainer');
                if (this.data.currentUser) {
                    const initials = this.data.currentUser.name.split(' ').map(n => n[0]).join('').toUpperCase();
                    authContainer.innerHTML = `
                        <div style="display:flex; align-items:center; gap:1rem;">
                            <button class="theme-btn" onclick="app.openModal('profileModal')" title="My Profile">
                                ${initials}
                            </button>
                            ${this.data.currentUser.role !== 'visitor' ? 
                                `<button class="btn-sm btn-primary" onclick="app.loadDash('overview')">Dashboard</button>` : 
                                `<button class="btn-sm btn-outline" onclick="app.showFavorites()">Favorites</button>`
                            }
                        </div>
                    `;
                } else {
                    authContainer.innerHTML = `
                        <button class="btn-primary" onclick="app.openModal('visitorModal')">Sign In</button>
                    `;
                }
            },

            // ===== NOTIFICATION SYSTEM =====
            showNotification: function(message, type = 'info') {
                const container = document.getElementById('notificationContainer');
                const id = 'notif-' + Date.now();
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.id = id;
                notification.innerHTML = `
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                    <span>${message}</span>
                    <button onclick="document.getElementById('${id}').remove()" style="margin-left:auto; background:none; border:none; color:white; cursor:pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                container.appendChild(notification);
                
                // Show with animation
                setTimeout(() => notification.classList.add('show'), 10);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 5000);
            },

            // ===== PROPERTY MANAGEMENT =====
            renderFeaturedProperties: function() {
                const featured = this.data.properties.filter(p => p.featured);
                this.renderPropertyGrid(featured, 'featuredGrid');
            },

            renderAllListings: function() {
                this.renderPropertyGrid(this.data.properties, 'listingsGrid');
                this.updateResultCount(this.data.properties.length);
            },

            renderPropertyGrid: function(properties, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                
                container.innerHTML = properties.map(property => `
                    <div class="property-card" onclick="app.route('detail', {id: ${property.id}})">
                        <div class="card-img-container">
                            <img src="${property.images ? property.images[0] : property.image}" alt="${property.title}" loading="lazy">
                            <span class="card-badge">${property.type}</span>
                            <button class="favorite-btn ${this.data.favorites.includes(property.id) ? 'active' : ''}" 
                                    onclick="event.stopPropagation(); app.toggleFavorite(${property.id})">
                                <i class="fas fa-heart"></i>
                            </button>
                        </div>
                        <div class="card-details">
                            <div>
                                <h3 style="font-size:1.2rem; margin-bottom:5px;">${property.title}</h3>
                                <p style="color:#777; font-size:0.9rem;">
                                    <i class="fas fa-map-marker-alt"></i> ${property.town}, ${property.province}
                                </p>
                            </div>
                            <div class="card-price">
                                $${property.price.toLocaleString()}${property.status === 'rent' ? '/mo' : ''}
                            </div>
                            <div class="card-meta">
                                <span><i class="fas fa-bed"></i> ${property.beds}</span>
                                <span><i class="fas fa-bath"></i> ${property.baths}</span>
                                <span><i class="fas fa-expand"></i> ${property.area}m</span>
                                ${property.year ? `<span><i class="fas fa-calendar"></i> ${property.year}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            renderPropertyDetail: function(propertyId) {
                const property = this.data.properties.find(p => p.id == propertyId);
                if (!property) return;
                
                const container = document.getElementById('detailContent');
                container.innerHTML = `
                    <div style="margin-bottom:2rem;">
                        <button onclick="app.route('listings')" class="btn-outline">
                            <i class="fas fa-arrow-left"></i> Back to Listings
                        </button>
                    </div>
                    
                    <div style="display:grid; grid-template-columns: 2fr 1fr; gap:3rem;">
                        <!-- Left: Images & Info -->
                        <div>
                            <div class="property-gallery">
                                <div class="gallery-main">
                                    <img src="${property.images ? property.images[0] : property.image}" alt="${property.title}" id="mainImage">
                                </div>
                                <div class="gallery-thumbs" id="galleryThumbs">
                                    ${property.images ? property.images.map((img, index) => `
                                        <div class="gallery-thumb" onclick="document.getElementById('mainImage').src = '${img}'">
                                            <img src="${img}" alt="Thumbnail ${index + 1}">
                                        </div>
                                    `).join('') : ''}
                                </div>
                            </div>
                            
                            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:1rem;">
                                <div>
                                    <h1 id="dTitle" style="font-size:2.5rem; margin-bottom:0.5rem;">${property.title}</h1>
                                    <p id="dAddr" style="font-size:1.1rem; color:#666;">
                                        <i class="fas fa-map-marker-alt"></i> ${property.address}, ${property.town}, ${property.province}
                                    </p>
                                </div>
                                <h2 id="dPrice" style="color:var(--primary-gold);">
                                    $${property.price.toLocaleString()}${property.status === 'rent' ? '/month' : ''}
                                </h2>
                            </div>

                            <div class="property-highlights">
                                <div class="highlight-card">
                                    <i class="fas fa-bed"></i>
                                    <h4>${property.beds}</h4>
                                    <p>Bedrooms</p>
                                </div>
                                <div class="highlight-card">
                                    <i class="fas fa-bath"></i>
                                    <h4>${property.baths}</h4>
                                    <p>Bathrooms</p>
                                </div>
                                <div class="highlight-card">
                                    <i class="fas fa-ruler-combined"></i>
                                    <h4>${property.area}</h4>
                                    <p>Square Meters</p>
                                </div>
                                <div class="highlight-card">
                                    <i class="fas fa-home"></i>
                                    <h4>${property.type}</h4>
                                    <p>Property Type</p>
                                </div>
                            </div>

                            <h3 style="margin-bottom:1rem;">Description</h3>
                            <p id="dDesc" style="margin-bottom:2rem; line-height:1.8; color:#555; white-space:pre-line;">
                                ${property.desc}
                            </p>

                            <h3 style="margin-bottom:1rem;">Features & Amenities</h3>
                            <div id="dFeatures" style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:2rem;">
                                ${property.tags.map(tag => `
                                    <span style="background:var(--gray-bg); padding:8px 16px; border-radius:20px; font-size:0.9rem;">
                                        <i class="fas fa-check" style="color:var(--primary-gold); margin-right:5px;"></i> ${tag}
                                    </span>
                                `).join('')}
                            </div>

                            ${property.virtualTour ? `
                                <h3 style="margin-bottom:1rem;">Virtual Tour</h3>
                                <div class="virtual-tour">
                                    <iframe src="${property.virtualTour}" allowfullscreen></iframe>
                                </div>
                            ` : ''}

                            <h3 style="margin-bottom:1rem;">Location</h3>
                            <div style="background:var(--gray-bg); height:300px; border-radius:12px; display:flex; align-items:center; justify-content:center; position:relative;">
                                <i class="fas fa-map-marked-alt" style="font-size:3rem; color:#ccc;"></i>
                                <a href="${property.mapLink || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(property.address + ' ' + property.town)}`}" 
                                   target="_blank" class="btn-primary" style="position:absolute; bottom:20px; left:50%; transform:translateX(-50%);">
                                    View on Google Maps
                                </a>
                            </div>
                        </div>

                        <!-- Right: Agent & Actions -->
                        <div>
                            <div style="background:var(--card-bg); padding:2rem; border-radius:12px; border:1px solid var(--border-color); position:sticky; top:120px;">
                                <h3 style="margin-bottom:1.5rem;">Schedule a Viewing</h3>
                                
                                <div class="form-group">
                                    <label>Select Date</label>
                                    <input type="text" id="viewingDate" placeholder="Choose a date" readonly>
                                </div>
                                
                                <div class="form-group">
                                    <label>Select Time</label>
                                    <select id="viewingTime">
                                        <option value="09:00">9:00 AM</option>
                                        <option value="10:00">10:00 AM</option>
                                        <option value="11:00">11:00 AM</option>
                                        <option value="14:00">2:00 PM</option>
                                        <option value="15:00">3:00 PM</option>
                                        <option value="16:00">4:00 PM</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label>Your Phone Number</label>
                                    <input type="tel" id="viewingPhone" placeholder="+263 77 123 4567">
                                </div>
                                
                                <button onclick="app.scheduleViewing(${property.id})" class="btn-primary" style="width:100%; margin-bottom:1rem;">
                                    <i class="fas fa-calendar-check"></i> Schedule Viewing
                                </button>
                                
                                <div style="display:flex; gap:10px;">
                                    <button onclick="app.contactAgent('whatsapp', ${property.id})" class="btn-primary" style="flex:1; background:#25D366; color:#fff;">
                                        <i class="fab fa-whatsapp"></i> WhatsApp
                                    </button>
                                    <button onclick="app.contactAgent('call', ${property.id})" class="btn-primary" style="flex:1; background:var(--dark-bg); color:#fff;">
                                        <i class="fas fa-phone"></i> Call
                                    </button>
                                </div>
                                
                                <div style="margin-top:2rem; padding-top:2rem; border-top:1px solid var(--border-color);">
                                    <h4 style="margin-bottom:1rem;">Assigned Agent</h4>
                                    <div style="display:flex; align-items:center; gap:1rem;">
                                        <img src="${this.data.agents[0].image}" alt="${this.data.agents[0].name}" style="width:60px; height:60px; border-radius:50%; object-fit:cover;">
                                        <div>
                                            <h5 style="margin-bottom:5px;">${this.data.agents[0].name}</h5>
                                            <p style="color:#777; font-size:0.9rem;">${this.data.agents[0].role}</p>
                                            <p style="color:var(--primary-gold); font-size:0.9rem;">
                                                <i class="fas fa-star"></i> ${this.data.agents[0].rating}/5
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // Initialize datepicker
                if (window.flatpickr) {
                    flatpickr("#viewingDate", {
                        minDate: "today",
                        dateFormat: "Y-m-d",
                        disable: [
                            function(date) {
                                // Disable weekends
                                return (date.getDay() === 0 || date.getDay() === 6);
                            }
                        ]
                    });
                }
            },

            // ===== ADVANCED FILTERING =====
            renderTagCloud: function() {
                const allTags = [...new Set(this.data.properties.flatMap(p => p.tags))];
                const container = document.getElementById('tagCloudFilter');
                if (container) {
                    container.innerHTML = allTags.map(tag => `
                        <div class="filter-tag" onclick="this.classList.toggle('active'); app.filterListings()">${tag}</div>
                    `).join('');
                }
            },

            populateTowns: function() {
                const province = document.getElementById('fProvince').value;
                const townSelect = document.getElementById('fTown');
                
                townSelect.innerHTML = '<option value="all">All Towns</option>';
                townSelect.disabled = (province === 'all');
                
                if (province !== 'all') {
                    const towns = [...new Set(this.data.properties
                        .filter(p => p.province === province)
                        .map(p => p.town))];
                    
                    towns.forEach(town => {
                        const option = document.createElement('option');
                        option.value = town;
                        option.textContent = town;
                        townSelect.appendChild(option);
                    });
                }
            },

            filterListings: function() {
                // Collect filter values
                const filters = {
                    search: document.getElementById('fSearch')?.value.toLowerCase() || '',
                    status: document.getElementById('fStatus')?.value || 'all',
                    province: document.getElementById('fProvince')?.value || 'all',
                    town: document.getElementById('fTown')?.value || 'all',
                    type: Array.from(document.querySelectorAll('.fType:checked')).map(c => c.value),
                    tags: Array.from(document.querySelectorAll('.filter-tag.active')).map(t => t.textContent),
                    minPrice: parseInt(document.getElementById('fPriceMinVal')?.value) || 0,
                    maxPrice: parseInt(document.getElementById('fPriceMaxVal')?.value) || 1000000,
                    year: document.getElementById('fYear')?.value || 'all',
                    beds: this.data.currentFilters.beds || 0
                };
                
                this.data.currentFilters = filters;
                
                // Apply filters
                const filtered = this.data.properties.filter(property => {
                    // Search filter
                    if (filters.search) {
                        const searchStr = `${property.title} ${property.desc} ${property.address} ${property.town} ${property.province}`.toLowerCase();
                        if (!searchStr.includes(filters.search)) return false;
                    }
                    
                    // Status filter
                    if (filters.status !== 'all' && property.status !== filters.status) return false;
                    
                    // Province filter
                    if (filters.province !== 'all' && property.province !== filters.province) return false;
                    
                    // Town filter
                    if (filters.town !== 'all' && property.town !== filters.town) return false;
                    
                    // Type filter
                    if (filters.type.length > 0 && !filters.type.includes(property.type)) return false;
                    
                    // Price filter
                    if (property.price < filters.minPrice || property.price > filters.maxPrice) return false;
                    
                    // Year filter
                    if (filters.year !== 'all' && property.year && parseInt(property.year) < parseInt(filters.year)) return false;
                    
                    // Bedrooms filter
                    if (filters.beds > 0 && property.beds < filters.beds) return false;
                    
                    // Tags filter
                    if (filters.tags.length > 0) {
                        const hasAllTags = filters.tags.every(tag => property.tags.includes(tag));
                        if (!hasAllTags) return false;
                    }
                    
                    return true;
                });
                
                this.renderPropertyGrid(filtered, 'listingsGrid');
                this.updateResultCount(filtered.length);
            },

            updatePriceRange: function() {
                const minVal = document.getElementById('fPriceMin').value;
                const maxVal = document.getElementById('fPriceMax').value;
                
                document.getElementById('fPriceMinVal').value = minVal;
                document.getElementById('fPriceMaxVal').value = maxVal;
                
                this.filterListings();
            },

            toggleBedFilter: function(beds) {
                this.data.currentFilters.beds = this.data.currentFilters.beds === parseInt(beds) ? 0 : parseInt(beds);
                this.filterListings();
            },

            resetFilters: function() {
                // Reset all filter inputs
                document.getElementById('fSearch').value = '';
                document.getElementById('fStatus').value = 'all';
                document.getElementById('fProvince').value = 'all';
                document.getElementById('fTown').value = 'all';
                document.getElementById('fTown').disabled = true;
                document.getElementById('fPriceMin').value = 0;
                document.getElementById('fPriceMax').value = 1000000;
                document.getElementById('fPriceMinVal').value = '';
                document.getElementById('fPriceMaxVal').value = '';
                document.getElementById('fYear').value = 'all';
                
                document.querySelectorAll('.fType:checked').forEach(cb => cb.checked = false);
                document.querySelectorAll('.filter-tag.active').forEach(tag => tag.classList.remove('active'));
                
                this.data.currentFilters = {};
                this.filterListings();
            },

            updateResultCount: function(count) {
                const element = document.getElementById('resultCount');
                if (element) {
                    element.textContent = `Showing ${count} propert${count === 1 ? 'y' : 'ies'}`;
                }
            },

            setViewMode: function(mode) {
                this.data.viewMode = mode;
                const listingsView = document.getElementById('listingsView');
                const mapView = document.getElementById('mapView');
                
                // Update button states
                document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`.view-btn[onclick*="${mode}"]`).classList.add('active');
                
                if (mode === 'map') {
                    listingsView.style.display = 'none';
                    mapView.classList.add('active');
                    // Here you would initialize the map with property markers
                } else {
                    mapView.classList.remove('active');
                    listingsView.style.display = 'grid';
                    
                    if (mode === 'list') {
                        listingsView.classList.add('list-view');
                    } else {
                        listingsView.classList.remove('list-view');
                    }
                }
            },

            sortListings: function(sortBy) {
                let sorted = [...this.data.properties];
                
                switch(sortBy) {
                    case 'price_asc':
                        sorted.sort((a, b) => a.price - b.price);
                        break;
                    case 'price_desc':
                        sorted.sort((a, b) => b.price - a.price);
                        break;
                    case 'area':
                        sorted.sort((a, b) => b.area - a.area);
                        break;
                    case 'newest':
                        // Assuming newer properties have higher IDs
                        sorted.sort((a, b) => b.id - a.id);
                        break;
                }
                
                this.renderPropertyGrid(sorted, 'listingsGrid');
            },

            // ===== FAVORITES SYSTEM =====
            toggleFavorite: function(propertyId) {
                const index = this.data.favorites.indexOf(propertyId);
                if (index > -1) {
                    this.data.favorites.splice(index, 1);
                    this.showNotification('Removed from favorites', 'info');
                } else {
                    this.data.favorites.push(propertyId);
                    this.showNotification('Added to favorites', 'success');
                }
                this.saveData();
                
                // Update UI
                const favoriteBtn = document.querySelector(`.favorite-btn[onclick*="${propertyId}"]`);
                if (favoriteBtn) {
                    favoriteBtn.classList.toggle('active');
                }
            },

            showFavorites: function() {
                if (!this.data.currentUser) {
                    this.showNotification('Please login to view favorites', 'warning');
                    this.openModal('visitorModal');
                    return;
                }
                
                const favoriteProperties = this.data.properties.filter(p => this.data.favorites.includes(p.id));
                if (favoriteProperties.length === 0) {
                    this.showNotification('No favorite properties yet', 'info');
                    return;
                }
                
                // You could create a modal or route to show favorites
                this.route('listings');
                // Apply filter to show only favorites
                // This is a simplified version
            },

            // ===== MORTGAGE CALCULATOR =====
            calculateMortgage: function() {
                const price = parseFloat(document.getElementById('mortgagePrice').value) || 300000;
                const downPaymentPercent = parseFloat(document.getElementById('downPayment').value) || 20;
                const loanTerm = parseFloat(document.getElementById('loanTerm').value) || 20;
                const interestRate = parseFloat(document.getElementById('interestRate').value) || 6.5;
                
                // Update display values
                document.getElementById('downPaymentVal').textContent = downPaymentPercent + '%';
                document.getElementById('interestRateVal').textContent = interestRate + '%';
                
                // Calculations
                const downPayment = (price * downPaymentPercent) / 100;
                const loanAmount = price - downPayment;
                const monthlyRate = interestRate / 100 / 12;
                const numberOfPayments = loanTerm * 12;
                
                // Monthly payment formula: M = P [ i(1 + i)^n ] / [ (1 + i)^n  1]
                const monthlyPayment = loanAmount * 
                    (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / 
                    (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
                
                const totalPayments = monthlyPayment * numberOfPayments;
                const totalInterest = totalPayments - loanAmount;
                
                // Update UI
                document.getElementById('monthlyPayment').textContent = '$' + Math.round(monthlyPayment).toLocaleString();
                document.getElementById('totalInterest').textContent = '$' + Math.round(totalInterest).toLocaleString();
                document.getElementById('loanAmount').textContent = '$' + Math.round(loanAmount).toLocaleString();
                document.getElementById('downPaymentAmount').textContent = '$' + Math.round(downPayment).toLocaleString();
                document.getElementById('totalPayments').textContent = '$' + Math.round(totalPayments).toLocaleString();
                
                // Update chart
                this.updateMortgageChart(loanAmount, totalInterest);
            },

            updateMortgageChart: function(principal, interest) {
                const ctx = document.getElementById('mortgageChart')?.getContext('2d');
                if (!ctx) return;
                
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Principal', 'Interest'],
                        datasets: [{
                            data: [principal, interest],
                            backgroundColor: ['#D4AF37', '#B8860B'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            },

            // ===== AGENT DIRECTORY =====
            renderAgents: function() {
                const container = document.getElementById('agentsGrid');
                if (!container) return;
                
                container.innerHTML = this.data.agents.map(agent => `
                    <div class="admin-card">
                        <img src="${agent.image}" alt="${agent.name}">
                        <div style="flex:1;">
                            <h4>${agent.name}</h4>
                            <div style="color:var(--primary-gold); font-weight:bold; margin:5px 0;">${agent.role}</div>
                            <div style="color:#777; font-size:0.9rem; margin-bottom:5px;">
                                <i class="fas fa-phone"></i> ${agent.phone}
                            </div>
                            <div style="color:#777; font-size:0.9rem; margin-bottom:5px;">
                                <i class="fas fa-envelope"></i> ${agent.email}
                            </div>
                            <div style="color:#777; font-size:0.9rem;">
                                <i class="fas fa-home"></i> ${agent.properties} properties
                                <span style="color:var(--primary-gold); margin-left:10px;">
                                    <i class="fas fa-star"></i> ${agent.rating}/5
                                </span>
                            </div>
                        </div>
                        <div class="admin-actions">
                            <button class="btn-outline btn-sm" onclick="app.contactAgent('whatsapp', null, '${agent.phone}')">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="btn-primary btn-sm" onclick="app.contactAgent('call', null, '${agent.phone}')">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            },

            // ===== BLOG/NEWS =====
            renderBlogPosts: function() {
                const container = document.getElementById('blogGrid');
                if (!container) return;
                
                container.innerHTML = this.data.blogPosts.map(post => `
                    <div class="property-card" onclick="app.openBlogPost(${post.id})">
                        <div class="card-img-container">
                            <img src="${post.image}" alt="${post.title}" loading="lazy">
                            <span class="card-badge">${post.category}</span>
                        </div>
                        <div class="card-details">
                            <div>
                                <h3 style="font-size:1.2rem; margin-bottom:5px;">${post.title}</h3>
                                <p style="color:#777; font-size:0.9rem; margin-bottom:10px;">
                                    <i class="fas fa-calendar"></i> ${new Date(post.date).toLocaleDateString()}
                                </p>
                                <p style="color:#555; font-size:0.9rem;">${post.excerpt}</p>
                            </div>
                            <div style="color:var(--primary-gold); font-weight:600; cursor:pointer;">
                                Read More <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            // ===== DASHBOARD FUNCTIONS =====
            loadDash: function(view) {
                if (!this.data.currentUser || this.data.currentUser.role === 'visitor') {
                    this.showNotification('Access denied. Staff login required.', 'error');
                    this.openModal('staffModal');
                    return;
                }
                
                // Hide main app, show dashboard
                document.getElementById('app-content').classList.add('d-none');
                document.getElementById('mainNav').classList.add('d-none');
                document.getElementById('breadcrumb').classList.add('d-none');
                document.getElementById('dashboard-panel').classList.remove('d-none');
                
                // Update sidebar active state
                document.querySelectorAll('.dash-menu a').forEach(a => a.classList.remove('active'));
                const activeLink = document.querySelector(`.dash-menu a[onclick*="${view}"]`);
                if (activeLink) activeLink.classList.add('active');
                
                // Show owner menu if owner
                const isOwner = this.data.currentUser.role === 'owner';
                document.getElementById('ownerMenu').classList.toggle('d-none', !isOwner);
                
                // Load view content
                this.renderDashboardView(view);
            },

            renderDashboardView: function(view) {
                const container = document.getElementById('dashContent');
                container.innerHTML = '';
                
                switch(view) {
                    case 'overview':
                        this.renderDashboardOverview(container);
                        break;
                    case 'add':
                        this.renderAddPropertyForm(container);
                        break;
                    case 'manage':
                        this.renderManageProperties(container);
                        break;
                    case 'kanban':
                        this.renderSalesPipeline(container);
                        break;
                    case 'requests':
                        if (this.data.currentUser.role === 'owner') {
                            this.renderAccessRequests(container);
                        }
                        break;
                    case 'team':
                        this.renderTeamManagement(container);
                        break;
                    default:
                        container.innerHTML = `<h2>Dashboard</h2><p>Welcome to your dashboard!</p>`;
                }
            },

            renderDashboardOverview: function(container) {
                const stats = {
                    totalProperties: this.data.properties.length,
                    totalViews: 12400,
                    pendingRequests: this.data.accessRequests.filter(r => r.status === 'pending').length,
                    monthlyRevenue: 125000
                };
                
                container.innerHTML = `
                    <div class="dash-header animate-up">
                        <h2>Dashboard Overview</h2>
                        <button class="btn-primary" onclick="app.loadDash('add')">
                            <i class="fas fa-plus"></i> Add Property
                        </button>
                    </div>
                    
                    <div class="stats-grid animate-up stagger-1">
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-home"></i></div>
                            <div>
                                <h3 style="font-size:1.8rem;">${stats.totalProperties}</h3>
                                <p style="color:#777;">Active Listings</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-eye"></i></div>
                            <div>
                                <h3 style="font-size:1.8rem;">${(stats.totalViews / 1000).toFixed(1)}k</h3>
                                <p style="color:#777;">Total Views</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-envelope"></i></div>
                            <div>
                                <h3 style="font-size:1.8rem;">${stats.pendingRequests}</h3>
                                <p style="color:#777;">Pending Requests</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                            <div>
                                <h3 style="font-size:1.8rem;">$${(stats.monthlyRevenue / 1000).toFixed(0)}k</h3>
                                <p style="color:#777;">Monthly Revenue</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chart-container animate-up stagger-2">
                        <h3 style="margin-bottom:1rem;">Monthly Performance</h3>
                        <canvas id="revenueChart" height="100"></canvas>
                    </div>
                    
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:2rem; margin-top:2rem;">
                        <div class="chart-container">
                            <h3 style="margin-bottom:1rem;">Property Types</h3>
                            <canvas id="typeChart" height="150"></canvas>
                        </div>
                        <div class="chart-container">
                            <h3 style="margin-bottom:1rem;">Top Agents</h3>
                            <div id="topAgents"></div>
                        </div>
                    </div>
                `;
                
                // Initialize charts
                setTimeout(() => {
                    this.initDashboardCharts();
                }, 100);
            },

            initDashboardCharts: function() {
                // Revenue chart
                const revenueCtx = document.getElementById('revenueChart')?.getContext('2d');
                if (revenueCtx) {
                    new Chart(revenueCtx, {
                        type: 'line',
                        data: {
                            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                            datasets: [{
                                label: 'Revenue (USD)',
                                data: [85, 92, 78, 95, 110, 125, 118, 135, 142, 130, 145, 160],
                                borderColor: '#D4AF37',
                                backgroundColor: 'rgba(212, 175, 55, 0.1)',
                                tension: 0.4,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { display: false }
                            }
                        }
                    });
                }
                
                // Property type chart
                const typeCtx = document.getElementById('typeChart')?.getContext('2d');
                if (typeCtx) {
                    const typeCounts = {};
                    this.data.properties.forEach(p => {
                        typeCounts[p.type] = (typeCounts[p.type] || 0) + 1;
                    });
                    
                    new Chart(typeCtx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(typeCounts),
                            datasets: [{
                                data: Object.values(typeCounts),
                                backgroundColor: ['#D4AF37', '#B8860B', '#F5D76E', '#FFF9E6', '#2C2C2C']
                            }]
                        },
                        options: {
                            responsive: true,
                            plugins: {
                                legend: { position: 'bottom' }
                            }
                        }
                    });
                }
            },

            renderAddPropertyForm: function(container) {
                container.innerHTML = `
                    <div class="dash-header animate-up">
                        <h2>Add New Property</h2>
                    </div>
                    
                    <div class="step-form">
                        <div class="step-indicator">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <div class="step-label">Basic Info</div>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <div class="step-label">Location</div>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <div class="step-label">Details</div>
                            </div>
                            <div class="step" data-step="4">
                                <div class="step-number">4</div>
                                <div class="step-label">Media</div>
                            </div>
                        </div>
                        
                        <div class="step-content active" data-step="1">
                            <h3 style="margin-bottom:1.5rem;">Basic Information</h3>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <label>Property Title *</label>
                                    <input type="text" id="pTitle" placeholder="e.g., Luxury Golf Estate" required>
                                </div>
                                <div class="form-group">
                                    <label>Property Type *</label>
                                    <select id="pType" required>
                                        <option value="">Select Type</option>
                                        <option value="House">House</option>
                                        <option value="Apartment">Apartment</option>
                                        <option value="Townhouse">Townhouse</option>
                                        <option value="Commercial">Commercial</option>
                                        <option value="Industrial">Industrial</option>
                                        <option value="Farm">Farm</option>
                                        <option value="Land">Land</option>
                                        <option value="Lodge">Lodge</option>
                                    </select>
                                </div>
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <label>Price (USD) *</label>
                                    <input type="number" id="pPrice" placeholder="e.g., 450000" required>
                                </div>
                                <div class="form-group">
                                    <label>Status *</label>
                                    <select id="pStatus" required>
                                        <option value="buy">For Sale</option>
                                        <option value="rent">For Rent</option>
                                        <option value="auction">Auction</option>
                                        <option value="foreclosure">Foreclosure</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Description *</label>
                                <textarea id="pDesc" rows="4" placeholder="Detailed description of the property..." required></textarea>
                            </div>
                            <div class="form-actions">
                                <button class="btn-outline" disabled>Previous</button>
                                <button class="btn-primary" onclick="app.nextStep(2)">Next</button>
                            </div>
                        </div>
                        
                        <div class="step-content" data-step="2">
                            <h3 style="margin-bottom:1.5rem;">Location Details</h3>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <label>Province *</label>
                                    <select id="pProvince" required>
                                        <option value="">Select Province</option>
                                        <option value="Harare">Harare</option>
                                        <option value="Bulawayo">Bulawayo</option>
                                        <option value="Manicaland">Manicaland</option>
                                        <option value="Mashonaland East">Mashonaland East</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Town/Suburb *</label>
                                    <input type="text" id="pTown" placeholder="e.g., Borrowdale" required>
                                </div>
                            </div>
                            <div class="form-group" style="margin-bottom:1.5rem;">
                                <label>Address *</label>
                                <input type="text" id="pAddress" placeholder="Full street address" required>
                            </div>
                            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1rem; margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <label>Google Maps Link</label>
                                    <input type="url" id="pMap" placeholder="https://goo.gl/maps/...">
                                </div>
                                <div class="form-group">
                                    <label>GPS Coordinates</label>
                                    <input type="text" id="pGPS" placeholder="e.g., -17.8252, 31.0335">
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="btn-outline" onclick="app.prevStep(1)">Previous</button>
                                <button class="btn-primary" onclick="app.nextStep(3)">Next</button>
                            </div>
                        </div>
                        
                        <div class="step-content" data-step="3">
                            <h3 style="margin-bottom:1.5rem;">Property Specifications</h3>
                            <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:1rem; margin-bottom:1.5rem;">
                                <div class="form-group">
                                    <label>Bedrooms</label>
                                    <input type="number" id="pBeds" min="0" placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label>Bathrooms</label>
                                    <input type="number" id="pBaths" min="0" placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label>Area (m)</label>
                                    <input type="number" id="pArea" min="0" placeholder="0">
                                </div>
                                <div class="form-group">
                                    <label>Year Built</label>
                                    <input type="number" id="pYear" min="1800" max="2024" placeholder="2020">
                                </div>
                            </div>
                            
                            <h4 style="margin-bottom:1rem; color:var(--primary-gold);">Amenities & Features</h4>
                            <div class="tag-cloud" style="margin-bottom:1.5rem;">
                                ${['Pool', 'Solar', 'Security', 'Borehole', 'Garden', 'Garage', 'Fiber Internet', 'Generator', 
                                   'Air Conditioning', 'Fireplace', 'Balcony', 'Gym', 'Elevator', 'Pet Friendly'].map(tag => `
                                    <label style="display:inline-flex; align-items:center; gap:5px; cursor:pointer;">
                                        <input type="checkbox" value="${tag}"> ${tag}
                                    </label>
                                `).join('')}
                            </div>
                            
                            <div class="form-group">
                                <label>Additional Tags (comma separated)</label>
                                <input type="text" id="pTags" placeholder="e.g., Luxury, Modern, Eco-friendly">
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn-outline" onclick="app.prevStep(2)">Previous</button>
                                <button class="btn-primary" onclick="app.nextStep(4)">Next</button>
                            </div>
                        </div>
                        
                        <div class="step-content" data-step="4">
                            <h3 style="margin-bottom:1.5rem;">Media & Final Details</h3>
                            <div class="form-group">
                                <label>Main Image URL *</label>
                                <input type="url" id="pMainImage" placeholder="https://images.unsplash.com/photo-..." required>
                            </div>
                            <div class="form-group">
                                <label>Additional Image URLs (one per line)</label>
                                <textarea id="pImages" rows="3" placeholder="https://image1.com&#10;https://image2.com"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Virtual Tour URL</label>
                                <input type="url" id="pTour" placeholder="https://www.youtube.com/embed/...">
                            </div>
                            <div class="form-group">
                                <label>Mark as Featured?</label>
                                <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                                    <input type="checkbox" id="pFeatured">
                                    Show in featured listings
                                </label>
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn-outline" onclick="app.prevStep(3)">Previous</button>
                                <button class="btn-primary" onclick="app.submitPropertyForm()">Publish Property</button>
                            </div>
                        </div>
                    </div>
                `;
            },

            nextStep: function(step) {
                document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.step').forEach(el => el.classList.remove('active'));
                
                document.querySelector(`.step-content[data-step="${step}"]`).classList.add('active');
                document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
            },

            prevStep: function(step) {
                this.nextStep(step);
            },

            submitPropertyForm: function() {
                // Collect form data
                const property = {
                    id: Date.now(),
                    title: document.getElementById('pTitle').value,
                    type: document.getElementById('pType').value,
                    price: parseFloat(document.getElementById('pPrice').value),
                    status: document.getElementById('pStatus').value,
                    desc: document.getElementById('pDesc').value,
                    province: document.getElementById('pProvince').value,
                    town: document.getElementById('pTown').value,
                    address: document.getElementById('pAddress').value,
                    mapLink: document.getElementById('pMap').value,
                    beds: parseInt(document.getElementById('pBeds').value) || 0,
                    baths: parseInt(document.getElementById('pBaths').value) || 0,
                    area: parseInt(document.getElementById('pArea').value) || 0,
                    year: parseInt(document.getElementById('pYear').value) || null,
                    featured: document.getElementById('pFeatured').checked,
                    images: document.getElementById('pImages').value.split('\n').filter(url => url.trim()),
                    tags: Array.from(document.querySelectorAll('[data-step="3"] input[type="checkbox"]:checked')).map(cb => cb.value)
                };
                
                // Add main image
                if (document.getElementById('pMainImage').value) {
                    property.images.unshift(document.getElementById('pMainImage').value);
                }
                
                // Add additional tags
                const additionalTags = document.getElementById('pTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
                property.tags.push(...additionalTags);
                
                // Add virtual tour
                if (document.getElementById('pTour').value) {
                    property.virtualTour = document.getElementById('pTour').value;
                }
                
                // Add to properties
                this.data.properties.push(property);
                this.saveData();
                
                this.showNotification('Property published successfully!', 'success');
                this.loadDash('manage');
            },

            renderManageProperties: function(container) {
                container.innerHTML = `
                    <div class="dash-header animate-up">
                        <h2>Manage Properties</h2>
                        <div style="display:flex; gap:1rem;">
                            <input type="text" placeholder="Search properties..." style="width:300px;" 
                                   oninput="app.searchDashboardProperties(this.value)">
                            <button class="btn-primary" onclick="app.loadDash('add')">
                                <i class="fas fa-plus"></i> Add New
                            </button>
                        </div>
                    </div>
                    
                    <div class="admin-grid animate-up stagger-1" id="dashboardProperties">
                        ${this.data.properties.map(property => `
                            <div class="admin-card">
                                <img src="${property.images ? property.images[0] : property.image}" alt="${property.title}">
                                <div style="flex:1;">
                                    <h4>${property.title}</h4>
                                    <div style="color:var(--primary-gold); font-weight:bold;">
                                        $${property.price.toLocaleString()}${property.status === 'rent' ? '/mo' : ''}
                                    </div>
                                    <small>${property.town}, ${property.province}</small>
                                    <div style="display:flex; gap:10px; margin-top:5px;">
                                        <span style="background:${property.status === 'buy' ? '#4CAF50' : '#2196F3'}; color:white; padding:2px 8px; border-radius:4px; font-size:0.8rem;">
                                            ${property.status === 'buy' ? 'For Sale' : 'For Rent'}
                                        </span>
                                        ${property.featured ? 
                                            `<span style="background:var(--primary-gold); color:black; padding:2px 8px; border-radius:4px; font-size:0.8rem;">
                                                Featured
                                            </span>` : ''
                                        }
                                    </div>
                                </div>
                                <div class="admin-actions">
                                    <button class="btn-outline btn-sm" onclick="app.editProperty(${property.id})" title="Edit">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn-primary btn-sm" style="background:#e74c3c; color:#fff;" 
                                            onclick="app.deleteProperty(${property.id})" title="Delete">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            },

            deleteProperty: function(id) {
                if (confirm('Are you sure you want to delete this property?')) {
                    this.data.properties = this.data.properties.filter(p => p.id !== id);
                    this.saveData();
                    this.renderManageProperties(document.getElementById('dashContent'));
                    this.showNotification('Property deleted', 'success');
                }
            },

            // ===== ACCESS REQUESTS MANAGEMENT =====
            renderAccessRequests: function(container) {
                const pending = this.data.accessRequests.filter(r => r.status === 'pending');
                const approved = this.data.accessRequests.filter(r => r.status === 'approved');
                const rejected = this.data.accessRequests.filter(r => r.status === 'rejected');
                
                container.innerHTML = `
                    <div class="dash-header animate-up">
                        <h2>Access Requests</h2>
                    </div>
                    
                    <div style="display:flex; gap:1rem; margin-bottom:2rem;">
                        <button class="btn-outline ${!this.data.requestsFilter || this.data.requestsFilter === 'pending' ? 'active' : ''}" 
                                onclick="app.filterRequests('pending')">Pending (${pending.length})</button>
                        <button class="btn-outline ${this.data.requestsFilter === 'approved' ? 'active' : ''}" 
                                onclick="app.filterRequests('approved')">Approved (${approved.length})</button>
                        <button class="btn-outline ${this.data.requestsFilter === 'rejected' ? 'active' : ''}" 
                                onclick="app.filterRequests('rejected')">Rejected (${rejected.length})</button>
                    </div>
                    
                    <div id="requestsList">
                        ${this.renderRequestsList(pending)}
                    </div>
                `;
            },

            renderRequestsList: function(requests) {
                if (requests.length === 0) {
                    return '<p style="text-align:center; padding:2rem; color:#777;">No requests found</p>';
                }
                
                return requests.map(request => `
                    <div class="stat-card" style="margin-bottom:1rem;">
                        <div style="flex:1;">
                            <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:0.5rem;">
                                <div>
                                    <h4>${request.name}</h4>
                                    <div style="color:#777; font-size:0.9rem;">
                                        ${request.email}  ${request.phone}  ${new Date(request.date).toLocaleDateString()}
                                    </div>
                                </div>
                                <span class="badge ${request.status === 'pending' ? 'badge-warning' : request.status === 'approved' ? 'badge-success' : 'badge-danger'}">
                                    ${request.status}
                                </span>
                            </div>
                            <div style="margin-bottom:0.5rem;">
                                <strong>Role Requested:</strong> ${request.role}
                            </div>
                            <div style="margin-bottom:0.5rem;">
                                <strong>Experience:</strong> ${request.experience || 'Not specified'}
                            </div>
                            <div>
                                <strong>Reason:</strong> ${request.reason}
                            </div>
                        </div>
                        <div style="display:flex; gap:10px; min-width:200px;">
                            ${request.status === 'pending' ? `
                                <button class="btn-primary" onclick="app.approveRequest(${request.id})">Approve</button>
                                <button class="btn-outline" style="border-color:#e74c3c; color:#e74c3c;" 
                                        onclick="app.rejectRequest(${request.id})">Reject</button>
                            ` : ''}
                        </div>
                    </div>
                `).join('');
            },

            approveRequest: function(requestId) {
                const request = this.data.accessRequests.find(r => r.id === requestId);
                if (request) {
                    request.status = 'approved';
                    
                    // Create user account
                    const newUser = {
                        id: Date.now(),
                        name: request.name,
                        email: request.email,
                        phone: request.phone,
                        password: this.generatePassword(),
                        role: request.role === 'admin' ? 'admin' : 'agent',
                        verified: true,
                        createdAt: new Date().toISOString()
                    };
                    
                    this.data.users.push(newUser);
                    this.saveData();
                    
                    this.showNotification(`Access approved for ${request.name}. Password: ${newUser.password}`, 'success');
                    this.renderAccessRequests(document.getElementById('dashContent'));
                }
            },

            rejectRequest: function(requestId) {
                const request = this.data.accessRequests.find(r => r.id === requestId);
                if (request) {
                    request.status = 'rejected';
                    this.saveData();
                    this.showNotification('Request rejected', 'info');
                    this.renderAccessRequests(document.getElementById('dashContent'));
                }
            },

            generatePassword: function() {
                return Math.random().toString(36).slice(-8);
            },

            // ===== UTILITY FUNCTIONS =====
            toggleTheme: function() {
                const current = document.body.getAttribute('data-theme');
                const newTheme = current === 'light' ? 'dark' : 'light';
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('aurumTheme', newTheme);
            },

            toggleMobileMenu: function() {
                document.getElementById('navMenu').classList.toggle('active');
            },

            contactAgent: function(method, propertyId, phone) {
                if (method === 'whatsapp') {
                    const message = propertyId ? 
                        `Hi, I'm interested in property ${propertyId}` : 
                        'Hi, I would like to inquire about your services';
                    const url = `https://wa.me/${phone || '263783455849'}?text=${encodeURIComponent(message)}`;
                    window.open(url, '_blank');
                } else {
                    alert(`Calling ${phone || '+263 78 345 5849'}`);
                }
            },

            scheduleViewing: function(propertyId) {
                const date = document.getElementById('viewingDate').value;
                const time = document.getElementById('viewingTime').value;
                const phone = document.getElementById('viewingPhone').value;
                
                if (!date || !time || !phone) {
                    this.showNotification('Please fill in all fields', 'error');
                    return;
                }
                
                // In a real app, this would send to backend
                this.showNotification(`Viewing scheduled for ${date} at ${time}. We'll call you at ${phone} to confirm.`, 'success');
                
                // Clear form
                document.getElementById('viewingDate').value = '';
                document.getElementById('viewingPhone').value = '';
            },

            saveSearch: function() {
                if (!this.data.currentUser) {
                    this.showNotification('Please login to save searches', 'warning');
                    this.openModal('visitorModal');
                    return;
                }
                
                const search = {
                    id: Date.now(),
                    filters: this.data.currentFilters,
                    date: new Date().toISOString(),
                    name: `Search ${this.data.savedSearches.length + 1}`
                };
                
                this.data.savedSearches.push(search);
                this.saveData();
                this.showNotification('Search saved successfully!', 'success');
            },

            setupEventListeners: function() {
                // Close modals on outside click
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('modal')) {
                        e.target.classList.remove('active');
                        document.body.style.overflow = 'auto';
                    }
                });
                
                // Close mobile menu on click outside
                document.addEventListener('click', (e) => {
                    const navMenu = document.getElementById('navMenu');
                    const menuBtn = document.querySelector('.mobile-menu-btn');
                    if (navMenu.classList.contains('active') && 
                        !navMenu.contains(e.target) && 
                        !menuBtn.contains(e.target)) {
                        navMenu.classList.remove('active');
                    }
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey && e.key === 'k') {
                        e.preventDefault();
                        document.getElementById('globalSearch').focus();
                    }
                    
                    if (e.key === 'Escape') {
                        document.querySelectorAll('.modal.active').forEach(modal => {
                            modal.classList.remove('active');
                        });
                        document.body.style.overflow = 'auto';
                    }
                });
            },

            showSearchSuggestions: function() {
                const input = document.getElementById('globalSearch');
                const container = document.getElementById('searchSuggestions');
                const query = input.value.toLowerCase();
                
                if (query.length < 2) {
                    container.classList.remove('show');
                    return;
                }
                
                // Filter properties for suggestions
                const suggestions = this.data.properties
                    .filter(p => 
                        p.title.toLowerCase().includes(query) ||
                        p.town.toLowerCase().includes(query) ||
                        p.province.toLowerCase().includes(query)
                    )
                    .slice(0, 5);
                
                if (suggestions.length > 0) {
                    container.innerHTML = suggestions.map(p => `
                        <div class="suggestion-item" onclick="app.selectSuggestion('${p.title}')">
                            <i class="fas fa-home"></i>
                            <div>
                                <div>${p.title}</div>
                                <small>${p.town}, ${p.province}</small>
                            </div>
                        </div>
                    `).join('');
                    container.classList.add('show');
                } else {
                    container.classList.remove('show');
                }
            },

            selectSuggestion: function(suggestion) {
                document.getElementById('globalSearch').value = suggestion;
                document.getElementById('searchSuggestions').classList.remove('show');
                this.handleSearch();
            },

            handleSearch: function(event) {
                if (event) event.preventDefault();
                
                const query = document.getElementById('globalSearch').value;
                const type = document.getElementById('searchType').value;
                const province = document.getElementById('searchProvince').value;
                const status = document.getElementById('searchStatus').value;
                
                // Navigate to listings with search parameters
                this.route('listings');
                
                // Apply search filters (simplified)
                setTimeout(() => {
                    if (query) document.getElementById('fSearch').value = query;
                    if (type !== 'all') {
                        document.querySelectorAll('.fType').forEach(cb => {
                            cb.checked = cb.value === type;
                        });
                    }
                    if (province !== 'all') {
                        document.getElementById('fProvince').value = province;
                        this.populateTowns();
                    }
                    if (status !== 'all') {
                        document.getElementById('fStatus').value = status;
                    }
                    
                    this.filterListings();
                }, 100);
            }
        };

        // Initialize app when page loads
        window.addEventListener('DOMContentLoaded', () => {
            app.init();
            
            // Set default price range values
            if (document.getElementById('fPriceMinVal')) {
                document.getElementById('fPriceMinVal').value = 0;
                document.getElementById('fPriceMaxVal').value = 1000000;
            }
        });

        // Make app available globally
        window.app = app;
    </script>
</body>
</html>
